(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/toupiaojilu/add-or-update"],{"019a":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return a}));var a={wPicker:function(){return Promise.all([r.e("common/vendor"),r.e("components/w-picker/w-picker")]).then(r.bind(null,"892b"))}},n=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"3bcc":function(e,t,r){"use strict";r.r(t);var a=r("019a"),n=r("6633");for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);r("8acf");var i,u=r("f0c5"),s=Object(u["a"])(n["default"],a["b"],a["c"],!1,null,"ccb6a7ca",null,!1,a["a"],i);t["default"]=s.exports},6633:function(e,t,r){"use strict";r.r(t);var a=r("b4c9"),n=r.n(a);for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},"7d4c":function(e,t,r){},"8acf":function(e,t,r){"use strict";var a=r("7d4c"),n=r.n(a);n.a},b4c9:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("a34a"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,a,n,o,i){try{var u=e[o](i),s=u.value}catch(c){return void r(c)}u.done?t(s):Promise.resolve(s).then(a,n)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var i=e.apply(t,r);function u(e){o(i,a,n,u,s,"next",e)}function s(e){o(i,a,n,u,s,"throw",e)}u(void 0)}))}}var u=function(){Promise.all([r.e("common/vendor"),r.e("components/w-picker/w-picker")]).then(function(){return resolve(r("892b"))}.bind(null,r)).catch(r.oe)},s={data:function(){return{cross:"",ruleForm:{biaoti:"",toupiaozhuti:"",tupian:"",piaoshu:"",toupiaoshijian:"",zhanghao:"",xingming:"",crossuserid:"",crossrefid:"",userid:""},piaoshuOptions:[],piaoshuIndex:0,user:{},ro:{biaoti:!1,toupiaozhuti:!1,tupian:!1,piaoshu:!1,toupiaoshijian:!1,zhanghao:!1,xingming:!1,crossuserid:!1,crossrefid:!1,userid:!1}}},components:{wPicker:u},computed:{baseUrl:function(){return this.$base.url}},onLoad:function(t){var r=this;return i(a.default.mark((function n(){var o,i,u,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r.ruleForm.toupiaoshijian=r.$utils.getCurDateTime(),o=e.getStorageSync("nowTable"),n.next=4,r.$api.session(o);case 4:if(i=n.sent,r.user=i.data,r.ruleForm.zhanghao=r.user.zhanghao,r.ro.zhanghao=!0,r.ruleForm.xingming=r.user.xingming,r.ro.xingming=!0,r.piaoshuOptions="1".split(","),r.ruleForm.userid=e.getStorageSync("userid"),t.refid&&(r.ruleForm.refid=t.refid,r.ruleForm.nickname=e.getStorageSync("nickname")),!t.id){n.next=19;break}return r.ruleForm.id=t.id,n.next=17,r.$api.info("toupiaojilu",r.ruleForm.id);case 17:i=n.sent,r.ruleForm=i.data;case 19:if(r.cross=t.cross,!t.cross){n.next=69;break}u=e.getStorageSync("crossObj"),n.t0=a.default.keys(u);case 23:if((n.t1=n.t0()).done){n.next=67;break}if(s=n.t1.value,"biaoti"!=s){n.next=29;break}return r.ruleForm.biaoti=u[s],r.ro.biaoti=!0,n.abrupt("continue",23);case 29:if("toupiaozhuti"!=s){n.next=33;break}return r.ruleForm.toupiaozhuti=u[s],r.ro.toupiaozhuti=!0,n.abrupt("continue",23);case 33:if("tupian"!=s){n.next=37;break}return r.ruleForm.tupian=u[s],r.ro.tupian=!0,n.abrupt("continue",23);case 37:if("piaoshu"!=s){n.next=41;break}return r.ruleForm.piaoshu=u[s],r.ro.piaoshu=!0,n.abrupt("continue",23);case 41:if("toupiaoshijian"!=s){n.next=45;break}return r.ruleForm.toupiaoshijian=u[s],r.ro.toupiaoshijian=!0,n.abrupt("continue",23);case 45:if("zhanghao"!=s){n.next=49;break}return r.ruleForm.zhanghao=u[s],r.ro.zhanghao=!0,n.abrupt("continue",23);case 49:if("xingming"!=s){n.next=53;break}return r.ruleForm.xingming=u[s],r.ro.xingming=!0,n.abrupt("continue",23);case 53:if("crossuserid"!=s){n.next=57;break}return r.ruleForm.crossuserid=u[s],r.ro.crossuserid=!0,n.abrupt("continue",23);case 57:if("crossrefid"!=s){n.next=61;break}return r.ruleForm.crossrefid=u[s],r.ro.crossrefid=!0,n.abrupt("continue",23);case 61:if("userid"!=s){n.next=65;break}return r.ruleForm.userid=u[s],r.ro.userid=!0,n.abrupt("continue",23);case 65:n.next=23;break;case 67:r.ruleForm.piaoshu=0,r.ro.piaoshu=!1;case 69:r.styleChange();case 70:case"end":return n.stop()}}),n)})))()},methods:{styleChange:function(){this.$nextTick((function(){}))},toupiaoshijianConfirm:function(e){console.log(e),this.ruleForm.toupiaoshijian=e.result,this.$forceUpdate()},piaoshuChange:function(e){this.piaoshuIndex=e.target.value,this.ruleForm.piaoshu=this.piaoshuOptions[this.piaoshuIndex]},tupianTap:function(){var e=this;this.$api.upload((function(t){e.ruleForm.tupian="upload/"+t.file,e.$forceUpdate(),e.$nextTick((function(){e.styleChange()}))}))},getUUID:function(){return(new Date).getTime()},onSubmitTap:function(){var t=this;return i(a.default.mark((function r(){var n,o,i,u,s,c,l,p,f,d;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.ruleForm.toupiaozhuti){r.next=3;break}return t.$utils.msg("投票主题不能为空"),r.abrupt("return");case 3:if(t.ruleForm.piaoshu){r.next=6;break}return t.$utils.msg("票数不能为空"),r.abrupt("return");case 6:if(!t.ruleForm.piaoshu||t.$validate.isIntNumer(t.ruleForm.piaoshu)){r.next=9;break}return t.$utils.msg("票数应输入整数"),r.abrupt("return");case 9:if(!t.cross){r.next=25;break}if(u=e.getStorageSync("statusColumnName"),s=e.getStorageSync("statusColumnValue"),""==u){r.next=25;break}if(c=e.getStorageSync("crossObj"),u.startsWith("[")){r.next=21;break}for(l in c)l==u&&(c[l]=s);return p=e.getStorageSync("crossTable"),r.next=19,t.$api.update("".concat(p),c);case 19:r.next=25;break;case 21:n=Number(e.getStorageSync("userid")),o=c["id"],i=e.getStorageSync("statusColumnName"),i=i.replace(/\[/,"").replace(/\]/,"");case 25:if(!o||!n){r.next=52;break}return t.ruleForm.crossuserid=n,t.ruleForm.crossrefid=o,f={page:1,limit:10,crossuserid:n,crossrefid:o},r.next=31,t.$api.list("toupiaojilu",f);case 31:if(d=r.sent,!(d.data.total>=i)){r.next=37;break}return t.$utils.msg(e.getStorageSync("tips")),r.abrupt("return",!1);case 37:return c=e.getStorageSync("crossObj"),p=e.getStorageSync("crossTable"),c.piaoshu=parseFloat(c.piaoshu)+parseFloat(t.ruleForm.piaoshu),r.next=42,t.$api.update("".concat(p),c);case 42:if(!t.ruleForm.id){r.next=47;break}return r.next=45,t.$api.update("toupiaojilu",t.ruleForm);case 45:r.next=49;break;case 47:return r.next=49,t.$api.add("toupiaojilu",t.ruleForm);case 49:t.$utils.msgBack("提交成功");case 50:r.next=65;break;case 52:return c=e.getStorageSync("crossObj"),p=e.getStorageSync("crossTable"),c.piaoshu=parseFloat(c.piaoshu)+parseFloat(t.ruleForm.piaoshu),r.next=57,t.$api.update("".concat(p),c);case 57:if(!t.ruleForm.id){r.next=62;break}return r.next=60,t.$api.update("toupiaojilu",t.ruleForm);case 60:r.next=64;break;case 62:return r.next=64,t.$api.add("toupiaojilu",t.ruleForm);case 64:t.$utils.msgBack("提交成功");case 65:case"end":return r.stop()}}),r)})))()},optionsChange:function(e){this.index=e.target.value},bindDateChange:function(e){this.date=e.target.value},getDate:function(e){var t=new Date,r=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();return"start"===e?r-=60:"end"===e&&(r+=2),a=a>9?a:"0"+a,n=n>9?n:"0"+n,"".concat(r,"-").concat(a,"-").concat(n)},toggleTab:function(e){this.$refs[e].show()}}};t.default=s}).call(this,r("543d")["default"])},f6c2:function(e,t,r){"use strict";(function(e){r("8ef1");a(r("66fd"));var t=a(r("3bcc"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])}},[["f6c2","common/runtime","common/vendor"]]]);